<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
    <script src="menu.js"></script>
    <script src="contasService.js"></script>
</head>

<body>
    <script>
        window.onload = onInit

        function onInit() {
            atualizaListaContas();

            let htmlMenu = menu();
            let element = document.getElementById('nav');
            element.innerHTML = htmlMenu;
        }

        function atualizaListaContas () {
            buscarContas().then(contas => {
                console.log('dados', contas)
                montarListaContas(contas);
            });
        }

        function montarListaContas(contas) {
            let divListaContas = document.getElementById('listaContas');

            let html = '<table class="table">';
            contas.forEach(conta => {
                html += `<tr><td>${conta.nome}</td><td>${conta.saldo}</td><td>${conta.created_at}</td></tr>`
            });

            divListaContas.innerHTML = html + '</table>'
        }

        async function criarConta(event) {
            event.preventDefault()
            let nomeConta = document.getElementById('nomeConta').value
            console.log('nomeConta', nomeConta);

            body = {
                'nomeConta': nomeConta
            };
            const url = 'http://localhost:8000/contas';
            const config = {
                method: 'POST',
                body: JSON.stringify(body)
            }
            return await fetch(url, config)
            .then(async(response) => {
                let text = await response.text()
                let dados = JSON.parse(text);
                if(!response.ok) throw dados.message;
                atualizaListaContas();
                return dados;
            })
            .catch((error) => {
                alert(error);
                console.error('error',error);
            });
        }
    </script>

    <nav id="nav"></nav>

    <h1>Criar Conta</h1>

    <form action="#" onsubmit="criarConta(event)">
        Nome Conta: <input type="text" name="nomeConta" id="nomeConta">
        <input type="submit" value="Criar">
    </form>

    <hr>

    <h1>Lista de Contas</h1>

    <div id="listaContas"></div>
</body>

</html>