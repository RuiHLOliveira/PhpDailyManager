<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
    <script src="menu.js"></script>
    <script src="tiposMovimentosService.js"></script>
</head>

<body>
    <script>
        window.onload = onInit

        function onInit() {
            atualizaListaTiposMovimentos();

            let htmlMenu = menu();
            let element = document.getElementById('nav');
            element.innerHTML = htmlMenu;
        }

        function atualizaListaTiposMovimentos () {
            buscarTiposMovimentos().then(tiposmovimentos => {
                console.log('dados', tiposmovimentos)
                montarListaTiposMovimentos(tiposmovimentos);
            });
        }


        function montarListaTiposMovimentos(tiposmovimentos) {
            let divListaTiposMovimentos = document.getElementById('listaTiposMovimentos');
            let html = '<table class="table">';
            tiposmovimentos.forEach(tipoMovimento => {
                html += `<tr><td>${tipoMovimento.nome}</td><td>${tipoMovimento.created_at}</td></tr>`
            });
            divListaTiposMovimentos.innerHTML = html + '</table>'
        }

        async function criarTipoMovimento(event) {
            event.preventDefault()
            let nomeTipoMovimento = document.getElementById('nomeTipoMovimento').value
            console.log('nomeTipoMovimento', nomeTipoMovimento);

            body = {
                'nomeTipoMovimento': nomeTipoMovimento
            };
            const url = 'http://localhost:8000/tiposmovimentos';
            const config = {
                method: 'POST',
                body: JSON.stringify(body)
            }
            return await fetch(url, config)
            .then(async(response) => {
                let text = await response.text()
                let dados = JSON.parse(text);
                if(!response.ok) throw dados.message;
                atualizaListaTiposMovimentos();
                return dados;
            })
            .catch((error) => {
                alert(error);
                console.error('error',error);
            });
        }
    </script>

    <nav id="nav"></nav>

    <h1>Criar TipoMovimento</h1>

    <form action="#" onsubmit="criarTipoMovimento(event)">
        Nome TipoMovimento: <input type="text" name="nomeTipoMovimento" id="nomeTipoMovimento">
        <input type="submit" value="Criar">
    </form>

    <hr>

    <h1>Lista de TiposMovimentos</h1>

    <div id="listaTiposMovimentos"></div>
</body>

</html>